// @use "global_styles" as *;
// @use "gauge-container";
$color-border: #d1d5db;
$color-bg: #f8f9fa;
$color-white: #ffffff;
$badge-blue-bg: #e6f2ff;
$badge-blue-text: #007aff;
$badge-purple-bg: #eeeefb;
$badge-purple-text: #5856d7;
$badge-violet-bg: #f7eefc;
$badge-violet-text: #3d1d4e;
$gap-default: 20px;

@mixin card-style($padding: 20px) {
	background-color: $color-white;
	border-radius: 4px;
	border: 1px solid $color-border;
	padding: 0;
	display: flex;
	flex-direction: column;

	.card__header {
		border-bottom: 1px solid $color-border;
		padding: 16px 20px;
		flex-shrink: 0; // header가 축소되지 않도록 설정
	}
	.card__content {
		padding: $padding;
		flex: 1; // 남은 공간을 content가 차지하도록 설정 (중요)
	}
}
html,
body {
	margin: 0;
	padding: 0;
	height: 100%;
	overflow-x: hidden;
	overflow-y: auto;
	background-color: $color-bg;

	.page-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 20px;
	}
	.page-layout {
		gap: 20px;
		display: grid;
		grid-template-columns: repeat(2, minmax(0, 1fr));
		grid-template-rows: 2.2fr 1fr;
		min-height: 100vh;
		min-width: 1200px;
		width: 100%;
		padding: 0 20px 20px 20px;
		box-sizing: border-box;
		grid-template-areas:
			"left-layout right-layout"
			"bottom-layout bottom-layout";
		.left-layout {
			display: flex;
			flex-direction: column;
			gap: 20px;
			grid-area: left-layout;
			.card {
				@include card-style;
				&:nth-child(1) {
					flex: 1.5;
					.card__content {
						display: flex;
						flex-direction: column;
						justify-content: center;
						align-items: center;
						padding: 20px;
						gap: 20px;
						.usage-cards {
							display: flex;
							justify-content: space-between;
							width: 100%;
							gap: 20px;
							.year-card {
								flex: 1;
								display: flex;
								flex-direction: column;
								gap: 16px;
								.content .saving-info-row tp-text {
									display: inline-flex;
								}
								.content {
									display: flex;
									flex-direction: column;
									gap: 20px;
									padding: 20px;
									background-color: #fafbfb;
									.gauge-container tp-text {
										margin-top: 13px;
									}
									.gauge-container {
										position: relative;
										padding-top: 30px;
										margin: 0px;
										min-height: 65px;
										flex-shrink: 0;
										.percent-badge {
											position: absolute;
											left: 0px;
											top: 0px;
											transform: translateX(-50%);
											background-color: #000;
											color: #fff;
											padding: 2px 8px;
											border-radius: 12px;
											font-size: 11px;
											font-weight: bold;
											white-space: nowrap;
											z-index: 10;
											&::after {
												// 아래쪽 삼각형 꼬리
												content: "";
												position: absolute;
												bottom: -4px;
												left: 50%;
												transform: translateX(-50%);
												border-left: 4px solid transparent;
												border-right: 4px solid transparent;
												border-top: 5px solid #1a1c1e;
											}
										}
										.gauge-wrapper {
											display: flex;
											align-items: center;
											height: 24px; // 게이지 두께
											gap: 0; // 구분선과 밀착시키기 위해 0 설정

											.gauge-segment {
												height: 100%;
												border-radius: 4px; // 피그마 디자인에 맞춘 곡률

												&.attained {
													background-color: #60c671; // 진한 초록
												}
												&.remaining {
													background-color: #94d3aa; // 연한 초록
												}
											}

											.gauge-divider {
												width: 4px; // 구분선 두께
												height: 100%; // 게이지와 동일한 높이
												background-color: #1a1c1e; // 검정색 수직 막대
												margin: 0 4px; // 구분선 양옆에 미세한 간격 (디자인에 따라 조절)
												z-index: 1;
											}
										}
									}
								}
							}
							.month-card {
								flex: 1;
								display: flex;
								flex-direction: column;
								gap: 16px;
								.content .saving-info-row tp-text {
									display: inline-flex;
								}
								.content {
									display: flex;
									flex-direction: column;
									gap: 20px;
									padding: 20px;
									background-color: #fafbfb;
									// .gauge-container : orange
									.gauge-container tp-text {
										margin-top: 13px;
									}
									.gauge-container {
										position: relative;
										padding-top: 30px;
										margin: 0px;
										min-height: 65px;
										flex-shrink: 0;
										.percent-badge {
											position: absolute;
											left: 0px;
											top: 0px;
											transform: translateX(-50%);
											background-color: #000;
											color: #fff;
											padding: 2px 8px;
											border-radius: 12px;
											font-size: 11px;
											font-weight: bold;
											white-space: nowrap;
											z-index: 10;
											&::after {
												// 아래쪽 삼각형 꼬리
												content: "";
												position: absolute;
												bottom: -4px;
												left: 50%;
												transform: translateX(-50%);
												border-left: 4px solid transparent;
												border-right: 4px solid transparent;
												border-top: 5px solid #1a1c1e;
											}
										}
										.gauge-wrapper {
											display: flex;
											align-items: center;
											height: 24px; // 게이지 두께
											gap: 0; // 구분선과 밀착시키기 위해 0 설정

											.gauge-segment {
												height: 100%;
												border-radius: 4px; // 피그마 디자인에 맞춘 곡률

												&.attained {
													background-color: #ff9500; // 진한 초록
												}
												&.remaining {
													background-color: #ffdeb0; // 연한 초록
												}
											}

											.gauge-divider {
												width: 4px; // 구분선 두께
												height: 100%; // 게이지와 동일한 높이
												background-color: #1a1c1e; // 검정색 수직 막대
												margin: 0 4px; // 구분선 양옆에 미세한 간격 (디자인에 따라 조절)
												z-index: 1;
											}
										}

										// &.green {
										// 	@include gauge-theme(#60c671, #94d3aa);
										// }
										// &.orange {
										// 	@include gauge-theme(#f5a623, #f8d3a3);
										// }
									}
								}
							}
						}
						#line-chart {
							width: 100%;
							height: 100%;
						}
					}
				}
				&:nth-child(2) {
					flex: 1;
					.card__content {
						display: flex;
						gap: 20px;
						justify-content: flex-start;
						align-items: center;
						.card__text {
							display: flex;
							flex-direction: column;
							align-items: flex-start;
							gap: 12px;
							.row tp-text {
								display: inline-block;
							}
							.row {
								display: flex;
								align-items: center;
								gap: 8px;
							}
						}
					}
				}
			}
		}

		.right-layout {
			display: flex;
			flex-direction: column;
			gap: 20px;
			grid-area: right-layout;
			.card {
				@include card-style;
				&:nth-child(1) {
					@include card-style(20px 24px);
					.card__content {
						flex: 1;
						display: flex;
						justify-content: center;
						gap: 20px; // 그리드 쓰는게 더 나을듯. 나중에 바꿔보던지.
						.vertical-divider {
							border-left: 1px solid $color-border;
							align-self: stretch;
						}
						.usage {
							flex: 1;
						}
						.charge {
							flex: 1;
						}
					}
				}
				&:nth-child(2) {
					flex: 3;
					.card__content {
						width: 100%;
						height: 100%;
					}
					.bar-chart {
						width: 100%;
						height: 100%;
					}
				}
				&:nth-child(3) {
					flex: 1.5;
					@include card-style(20px 24px);
					.card__content {
						display: flex;
						justify-content: flex-start;
						gap: 40px;
						align-items: center;
						.vertical-divider {
							border-left: 1px solid $color-border;
							align-self: stretch;
						}
						.status-box {
							display: flex;
							flex: 1;
							flex-direction: column;
							justify-content: flex-start;
							gap: 18px;
							height: 100%;
							.status {
								display: flex;
								flex-direction: column;
								gap: 12px;
								.status-item {
									display: flex;
									flex-direction: column;
									justify-content: flex-start;
									align-items: flex-start;
									gap: 8px;
								}
							}
						}
						.mode-box {
							display: flex;
							flex-direction: column;
							gap: 8px;
							flex: 1;
							justify-content: flex-start;
							height: 100%;
							.mode {
								display: flex;
								flex-direction: column;
								justify-content: space-evenly;
								gap: 8px;
								.mode-item {
									display: inline-flex;
									align-items: center;
									gap: 8px;
									.badge {
										display: inline-flex;
										align-items: center;
										justify-content: center;
										padding: 4px 8px;
										border-radius: 4px;
										&.blue {
											background-color: $badge-blue-bg;
											tp-text {
												color: $badge-blue-text;
											}
										}
										&.purple {
											background-color: $badge-purple-bg;
											tp-text {
												color: $badge-purple-text;
											}
										}
										&.violet {
											background-color: $badge-violet-bg;
											tp-text {
												color: $badge-violet-text;
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}

		.bottom-layout {
			grid-area: bottom-layout;
			.card {
				@include card-style;
				height: 100%;
				.card__header .key-district-header {
					display: flex;
					justify-content: space-between;
					align-items: center;
					.weather-text {
						display: flex;
						gap: 12px;
						align-items: center;
						.weather-item {
							display: flex;
							align-items: center;
							gap: 4px; // 아이콘과 텍스트 사이 간격
						}
						.weather-item tp-text {
							display: inline-block;
						}
					}
				}
				.card__content {
					display: flex;
					flex-direction: column;
					.status-tabs {
						display: flex;
						// justify-content: space-evenly;
						gap: 20px;
						.status-tab {
							gap: 12px;
							flex: 1;
							border: 1px solid $color-border;
						}
					}
					.district-card-list {
						display: flex;
						flex-wrap: wrap;
						justify-content: flex-start;
						padding: 8px;
						gap: 20px;
						background-color: transparent;
						transition: background-color 0.2s ease;

						&.bg-danger {
							background-color: var(--tp-color-red-light);
						}
						&.bg-warning {
							background-color: var(--tp-color-yellow-light);
						}
						&.bg-normal {
							background-color: var(--tp-color-green-light);
						}
						&.bg-etc {
							background-color: var(--tp-color-gray-light);
						}

						.district-card {
							background-color: $color-white;
							display: flex;
							flex-direction: column;
							justify-content: flex-start;
							border: 1px solid $color-border;
							gap: 16px;
							padding: 20px 24px;
							min-width: 280px;
							flex: 0 0 auto;
							box-sizing: border-box;

							.dist-card__header {
								display: flex;
								flex-direction: row;
								gap: 40px;
								justify-content: space-between;
								.dot {
									width: 8px;
									height: 8px;
									border-radius: 50%;
								}
								.header-row {
									display: flex;
									align-items: center;
									gap: 4px;
								}
							}
							.dist-card-body {
								display: flex;
								flex-direction: column;
								gap: 8px;
								.info-row {
									display: flex;
									justify-content: space-between;
									align-items: center;
									width: 100%;
								}
								.dist-card-color {
									display: inline-flex;
									align-items: center;
									justify-content: center;
									padding: 4px 8px;
									border-radius: 4px;
									&.purple {
										background-color: $badge-purple-bg;
										tp-text {
											color: $badge-purple-text;
										}
									}
								}
							}

							// 상태별 점과 텍스트 색상
							&.normal {
								.dist-card__header {
									.dot {
										background-color: var(--tp-color-green-normal);
									}
									.header-row .tp-text {
										color: var(--tp-color-green-normal);
									}
								}
							}
							&.warning {
								.dist-card__header {
									.dot {
										background-color: var(--tp-color-orange-normal);
									}
									.header-row .tp-text {
										color: var(--tp-color-orange-normal);
									}
								}
							}
							&.danger {
								.dist-card__header {
									.dot {
										background-color: var(--tp-color-red-normal);
									}
									.header-row .tp-text {
										color: var(--tp-color-red-normal);
									}
								}
							}
							&.gray {
								.dist-card__header {
									.dot {
										background-color: var(--tp-color-gray-darker);
									}
									.header-row .tp-text {
										color: var(--tp-color-gray-darker);
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

// Escape from hell nesting, later refactor needed
.card__image {
	position: relative; // 자식들의 기준점 역할
	width: 100px; // 디자인 가이드에 따른 고정 크기
	height: 100px;
	display: flex; // 내부 요소 정렬을 위해 flex 사용 권장
	justify-content: center;
	align-items: center;

	// 모든 자식 이미지 공통 설정
	img {
		position: absolute; // 이미지를 공중에 띄워 겹침
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%); // 완벽한 중앙 정렬
	}

	// 배경 이미지 (밑에 깔림)
	&--bg {
		width: 100%; // 부모 크기에 꽉 차게
		height: auto;
		z-index: 1; // 낮은 우선순위
	}

	// 아이콘 이미지 (위에 올라감)
	&--icon {
		width: 50%; // 배경 원보다 작게 설정 (예: 50px)
		height: auto;
		z-index: 2; // 배경보다 높은 우선순위

		// 부드러운 효과를 원한다면 (Ease-out 적용)
		transition: transform 0.3s ease-out;
	}

	// 마우스 올렸을 때 아이콘만 살짝 커지는 효과
	&:hover &--icon {
		transform: translate(-50%, -50%) scale(1.1);
	}
}
// Line Break Style
.line-break {
	flex-basis: 100%;
	height: 0;
}

// Status Tabs Styles

.status-tabs {
	.tab {
		display: flex;
		justify-content: flex-start;
		flex: 1;
		gap: 12px;
		padding-bottom: 8px;
		align-items: center;

		.box {
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 0px 12px;
			height: 32px;

			.dot {
				width: 8px;
				height: 8px;
				border-radius: 50%;
			}
		}
	}
}

$status-color: (
	danger: (
		dot: var(--tp-color-red-normal),
		bg: var(--tp-color-red-light),
	),
	warning: (
		dot: var(--tp-color-orange-normal),
		bg: var(--tp-color-yellow-light),
	),
	normal: (
		dot: var(--tp-color-green-normal),
		bg: var(--tp-color-green-light),
	),
	gray: (
		dot: var(--tp-color-gray-darker),
		bg: var(--tp-color-gray-light),
	),
);

.status-tabs {
	@each $status, $colors in $status-color {
		.tab.#{$status} {
			.box {
				background-color: map-get($colors, bg);
				.dot {
					background-color: map-get($colors, dot);
				}
				.tp-text {
					color: map-get($colors, dot);
				}
			}
			&.active {
				border-bottom: 2px solid map-get($colors, dot);
			}
			&:hover {
				cursor: pointer;
				opacity: 0.8;
			}
			&.disabled {
				.box {
					background-color: transparent;
				}
			}
		}
		tp-text {
			color: var(--tp-color-gray-darker);
		}
	}
}
